--[[ 
    NOTICAX V2 - SPEED UPDATE
    - Nova Aba: Speed Hack (WalkSpeed)
    - Sistema de Abas (Tabs)
    - Loading Screen Mantido
    - Fly God Mode Mantido
]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local Player = Players.LocalPlayer
local Camera = workspace.CurrentCamera

-- --- PROTEÇÃO (Auto-Detect) ---
local function getGuiParent()
    local success, parent = pcall(function() return gethui() end)
    if success and parent then return parent end
    success, parent = pcall(function() return game:GetService("CoreGui") end)
    if success and parent then return parent end
    return Player:WaitForChild("PlayerGui")
end

local oldGui = getGuiParent():FindFirstChild("Noticax_v2")
if oldGui then oldGui:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "Noticax_v2"
ScreenGui.Parent = getGuiParent()
ScreenGui.ResetOnSpawn = false

-- Variáveis Globais
local flySpeed = 50
local walkSpeed = 50 -- Velocidade inicial do Speed
local flying = false
local speeding = false -- Controle do Speed
local bv, bg
local activeParticles
local animTrack 
local FLY_ANIM_ID = "rbxassetid://616006778" 

-- ==========================================
-- 1. TELA DE LOADING (Igual a v1)
-- ==========================================

local LoadingFrame = Instance.new("Frame", ScreenGui)
LoadingFrame.Size = UDim2.new(0, 220, 0, 120)
LoadingFrame.Position = UDim2.new(0.5, -110, 0.4, 0)
LoadingFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
LoadingFrame.BorderSizePixel = 0
LoadingFrame.Visible = true
Instance.new("UICorner", LoadingFrame).CornerRadius = UDim.new(0, 10)

local LoadStroke = Instance.new("UIStroke", LoadingFrame)
LoadStroke.Thickness = 2
spawn(function()
    while LoadingFrame.Parent do 
        local hue = tick() % 5 / 5
        LoadStroke.Color = Color3.fromHSV(hue, 1, 1)
        task.wait()
    end
end)

local LoadTitle = Instance.new("TextLabel", LoadingFrame)
LoadTitle.Text = "Noticax v2" -- Atualizei pra v2
LoadTitle.Size = UDim2.new(1, 0, 0, 40)
LoadTitle.BackgroundTransparency = 1
LoadTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
LoadTitle.Font = Enum.Font.GothamBlack
LoadTitle.TextSize = 20

local LoadStatus = Instance.new("TextLabel", LoadingFrame)
LoadStatus.Text = "Carregando Atualização..."
LoadStatus.Position = UDim2.new(0, 0, 0, 85)
LoadStatus.Size = UDim2.new(1, 0, 0, 20)
LoadStatus.BackgroundTransparency = 1
LoadStatus.TextColor3 = Color3.fromRGB(150, 150, 150)
LoadStatus.Font = Enum.Font.Gotham
LoadStatus.TextSize = 12

local BarBack = Instance.new("Frame", LoadingFrame)
BarBack.Size = UDim2.new(0, 180, 0, 6)
BarBack.Position = UDim2.new(0, 20, 0, 60)
BarBack.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
BarBack.BorderSizePixel = 0
Instance.new("UICorner", BarBack).CornerRadius = UDim.new(1, 0)

local BarFill = Instance.new("Frame", BarBack)
BarFill.Size = UDim2.new(0, 0, 1, 0) 
BarFill.BackgroundColor3 = Color3.fromRGB(0, 255, 255) 
BarFill.BorderSizePixel = 0
Instance.new("UICorner", BarFill).CornerRadius = UDim.new(1, 0)

-- ==========================================
-- 2. MENU PRINCIPAL COM ABAS
-- ==========================================

local ToggleBtn = Instance.new("TextButton", ScreenGui)
ToggleBtn.Name = "OpenButton"
ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
ToggleBtn.Position = UDim2.new(0.85, 0, 0.4, 0)
ToggleBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ToggleBtn.Text = "M"
ToggleBtn.TextColor3 = Color3.fromRGB(0, 255, 255)
ToggleBtn.Font = Enum.Font.GothamBlack
ToggleBtn.TextSize = 18
ToggleBtn.BorderSizePixel = 0
ToggleBtn.Visible = false 
Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(0, 10)
local ToggleStroke = Instance.new("UIStroke", ToggleBtn)
ToggleStroke.Thickness = 2
ToggleStroke.Color = Color3.fromRGB(0, 255, 255)

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 250, 0, 340) -- Aumentei um pouco pra caber as abas
MainFrame.Position = UDim2.new(0.5, -125, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Visible = false 
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 12)

local MainStroke = Instance.new("UIStroke", MainFrame)
MainStroke.Thickness = 3

spawn(function()
    while task.wait() do
        local hue = tick() % 5 / 5
        local color = Color3.fromHSV(hue, 1, 1)
        MainStroke.Color = color
        ToggleStroke.Color = color
    end
end)

local Title = Instance.new("TextLabel", MainFrame)
Title.Text = "Noticax v2"
Title.Size = UDim2.new(1, 0, 0, 35)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 22

local CloseX = Instance.new("TextButton", MainFrame)
CloseX.Text = "X"
CloseX.Size = UDim2.new(0, 30, 0, 30)
CloseX.Position = UDim2.new(1, -35, 0, 2)
CloseX.BackgroundTransparency = 1
CloseX.TextColor3 = Color3.fromRGB(255, 50, 50)
CloseX.Font = Enum.Font.GothamBold
CloseX.TextSize = 16

-- SISTEMA DE ABAS (CONTAINER)
local TabFrame = Instance.new("Frame", MainFrame)
TabFrame.Size = UDim2.new(1, -20, 0, 35)
TabFrame.Position = UDim2.new(0, 10, 0, 40)
TabFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Instance.new("UICorner", TabFrame).CornerRadius = UDim.new(0, 8)

local FlyTabBtn = Instance.new("TextButton", TabFrame)
FlyTabBtn.Text = "VOO ✈️"
FlyTabBtn.Size = UDim2.new(0.5, 0, 1, 0)
FlyTabBtn.BackgroundTransparency = 1
FlyTabBtn.TextColor3 = Color3.fromRGB(0, 255, 255) -- Ativo por padrão
FlyTabBtn.Font = Enum.Font.GothamBold
FlyTabBtn.TextSize = 14

local SpeedTabBtn = Instance.new("TextButton", TabFrame)
SpeedTabBtn.Text = "SPEED ⚡"
SpeedTabBtn.Size = UDim2.new(0.5, 0, 1, 0)
SpeedTabBtn.Position = UDim2.new(0.5, 0, 0, 0)
SpeedTabBtn.BackgroundTransparency = 1
SpeedTabBtn.TextColor3 = Color3.fromRGB(150, 150, 150) -- Inativo
SpeedTabBtn.Font = Enum.Font.GothamBold
SpeedTabBtn.TextSize = 14

-- PAGINAS (PAGES)
local PageFly = Instance.new("Frame", MainFrame) -- Página do Fly
PageFly.Size = UDim2.new(1, 0, 0, 250)
PageFly.Position = UDim2.new(0, 0, 0, 80)
PageFly.BackgroundTransparency = 1
PageFly.Visible = true

local PageSpeed = Instance.new("Frame", MainFrame) -- Página do Speed
PageSpeed.Size = UDim2.new(1, 0, 0, 250)
PageSpeed.Position = UDim2.new(0, 0, 0, 80)
PageSpeed.BackgroundTransparency = 1
PageSpeed.Visible = false

-- --- LÓGICA DAS ABAS ---
FlyTabBtn.MouseButton1Click:Connect(function()
    PageFly.Visible = true
    PageSpeed.Visible = false
    FlyTabBtn.TextColor3 = Color3.fromRGB(0, 255, 255)
    SpeedTabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
end)

SpeedTabBtn.MouseButton1Click:Connect(function()
    PageFly.Visible = false
    PageSpeed.Visible = true
    FlyTabBtn.TextColor3 = Color3.fromRGB(150, 150, 150)
    SpeedTabBtn.TextColor3 = Color3.fromRGB(0, 255, 255)
end)

-- ==========================================
-- CONTEÚDO DA ABA 1: VOO (FLY)
-- ==========================================

-- Função auxiliar para botões
local function makeButton(parent, text, yPos, color)
    local btn = Instance.new("TextButton", parent)
    btn.Text = text
    btn.Size = UDim2.new(0, 210, 0, 45)
    btn.Position = UDim2.new(0, 20, 0, yPos)
    btn.BackgroundColor3 = color
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.AutoButtonColor = true
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    return btn
end

local FlyBtn = makeButton(PageFly, "ATIVAR VOO", 10, Color3.fromRGB(30, 30, 30))
local FlyUp = makeButton(PageFly, "AUMENTAR VOO (+)", 65, Color3.fromRGB(0, 100, 50))
local FlyDown = makeButton(PageFly, "DIMINUIR VOO (-)", 120, Color3.fromRGB(100, 0, 0))

local FlyLabel = Instance.new("TextLabel", PageFly)
FlyLabel.Text = "Velocidade Voo: " .. flySpeed
FlyLabel.Size = UDim2.new(1, 0, 0, 30)
FlyLabel.Position = UDim2.new(0, 0, 0, 170)
FlyLabel.BackgroundTransparency = 1
FlyLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
FlyLabel.Font = Enum.Font.GothamBold

-- ==========================================
-- CONTEÚDO DA ABA 2: SPEED
-- ==========================================

local SpeedBtn = makeButton(PageSpeed, "ATIVAR SPEED", 10, Color3.fromRGB(30, 30, 30))
local SpeedUpBtn = makeButton(PageSpeed, "MAIS RÁPIDO (+)", 65, Color3.fromRGB(0, 100, 50))
local SpeedDownBtn = makeButton(PageSpeed, "MAIS LENTO (-)", 120, Color3.fromRGB(100, 0, 0))

local SpeedLabel = Instance.new("TextLabel", PageSpeed)
SpeedLabel.Text = "Velocidade Correr: " .. walkSpeed
SpeedLabel.Size = UDim2.new(1, 0, 0, 30)
SpeedLabel.Position = UDim2.new(0, 0, 0, 170)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
SpeedLabel.Font = Enum.Font.GothamBold

-- ==========================================
-- LÓGICA DE FUNCIONAMENTO
-- ==========================================

ToggleBtn.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)
CloseX.MouseButton1Click:Connect(function() MainFrame.Visible = false end)

-- --- FUNÇÃO AURA ---
local function createMegaAura(rootPart)
    local att = Instance.new("Attachment", rootPart)
    local p1 = Instance.new("ParticleEmitter", att)
    p1.Texture = "rbxassetid://243098098"
    p1.Size = NumberSequence.new({NumberSequenceKeypoint.new(0, 3), NumberSequenceKeypoint.new(1, 0)})
    p1.Rate = 120 
    p1.Lifetime = NumberRange.new(0.5, 0.8)
    p1.Speed = NumberRange.new(2)
    p1.Color = ColorSequence.new(Color3.fromRGB(0, 255, 255), Color3.fromRGB(0, 100, 255))
    p1.LightEmission = 1
    p1.Transparency = NumberSequence.new(0.3, 1)
    local p2 = Instance.new("ParticleEmitter", att)
    p2.Texture = "rbxassetid://242205514"
    p2.Size = NumberSequence.new(0.5, 1.5)
    p2.Rate = 60
    p2.Lifetime = NumberRange.new(0.3, 0.6)
    p2.Speed = NumberRange.new(12)
    p2.SpreadAngle = Vector2.new(360, 360)
    p2.Color = ColorSequence.new(Color3.fromRGB(255, 255, 255))
    p2.LightEmission = 1
    return att
end

-- --- FLY LOGIC ---
FlyBtn.MouseButton1Click:Connect(function()
    flying = not flying
    local char = Player.Character or Player.CharacterAdded:Wait()
    local root = char:FindFirstChild("HumanoidRootPart")
    local humanoid = char:FindFirstChild("Humanoid")
    local animator = humanoid:FindFirstChild("Animator") or Instance.new("Animator", humanoid)
    
    if not root or not humanoid then return end

    if flying then
        FlyBtn.Text = "GOD MODE (ON)"
        FlyBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
        local anim = Instance.new("Animation")
        anim.AnimationId = FLY_ANIM_ID
        animTrack = animator:LoadAnimation(anim)
        animTrack.Priority = Enum.AnimationPriority.Action4
        animTrack.Looped = true
        animTrack:Play(0.5) 
        activeParticles = createMegaAura(root)
        bv = Instance.new("BodyVelocity", root)
        bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
        bg = Instance.new("BodyGyro", root)
        bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        bg.P = 20000
        spawn(function()
            while flying and humanoid.Health > 0 do
                local moveDir = humanoid.MoveDirection
                local look = Camera.CFrame.LookVector
                local right = Camera.CFrame.RightVector
                bg.CFrame = Camera.CFrame
                if moveDir.Magnitude > 0 then
                    local flatLook = (look * Vector3.new(1,0,1)).Unit
                    if flatLook.X ~= flatLook.X then flatLook = Vector3.new(0,0,-1) end
                    local forwardStr = moveDir:Dot(flatLook)
                    local sideStr = moveDir:Dot(right)
                    local finalVel = (look * forwardStr + right * sideStr)
                    bv.Velocity = finalVel * flySpeed
                else
                    bv.Velocity = Vector3.new(0,0,0)
                end
                task.wait()
            end
            if flying then
                flying = false
                FlyBtn.Text = "ATIVAR VOO"
                FlyBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            end
            if animTrack then animTrack:Stop(0.5) animTrack:Destroy() end
            if activeParticles then activeParticles:Destroy() end
            if bv then bv:Destroy() end
            if bg then bg:Destroy() end
        end)
    else
        FlyBtn.Text = "ATIVAR VOO"
        FlyBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        if animTrack then animTrack:Stop(0.5) animTrack:Destroy() end
        if activeParticles then activeParticles:Destroy() end
        if bv then bv:Destroy() end
        if bg then bg:Destroy() end
    end
end)

FlyUp.MouseButton1Click:Connect(function()
    flySpeed = flySpeed + 10
    FlyLabel.Text = "Velocidade Voo: " .. flySpeed
end)
FlyDown.MouseButton1Click:Connect(function()
    flySpeed = math.max(10, flySpeed - 10)
    FlyLabel.Text = "Velocidade Voo: " .. flySpeed
end)

-- --- SPEED LOGIC ---
SpeedBtn.MouseButton1Click:Connect(function()
    speeding = not speeding
    local char = Player.Character or Player.CharacterAdded:Wait()
    local hum = char:FindFirstChild("Humanoid")
    
    if speeding then
        SpeedBtn.Text = "SPEED ATIVADO"
        SpeedBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 255)
        
        -- Loop para garantir que o speed não resete
        spawn(function()
            while speeding and hum and hum.Health > 0 do
                hum.WalkSpeed = walkSpeed
                task.wait(0.1) -- Força o speed a cada 0.1s
            end
            -- Quando desativar, volta ao normal
            if hum then hum.WalkSpeed = 16 end
        end)
    else
        SpeedBtn.Text = "ATIVAR SPEED"
        SpeedBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        if hum then hum.WalkSpeed = 16 end
    end
end)

SpeedUpBtn.MouseButton1Click:Connect(function()
    walkSpeed = walkSpeed + 10
    SpeedLabel.Text = "Velocidade Correr: " .. walkSpeed
end)
SpeedDownBtn.MouseButton1Click:Connect(function()
    walkSpeed = math.max(16, walkSpeed - 10)
    SpeedLabel.Text = "Velocidade Correr: " .. walkSpeed
end)

Player.CharacterAdded:Connect(function()
    flying = false
    speeding = false
    FlyBtn.Text = "ATIVAR VOO"
    SpeedBtn.Text = "ATIVAR SPEED"
    if activeParticles then activeParticles:Destroy() end
    if animTrack then animTrack:Stop() animTrack:Destroy() end
end)

-- LOADING EXECUTION
spawn(function()
    LoadStatus.Text = "Iniciando Noticax v2..."
    wait(0.5)
    BarFill:TweenSize(UDim2.new(0.5, 0, 1, 0), "Out", "Quad", 1)
    LoadStatus.Text = "Carregando Abas..."
    wait(1)
    BarFill:TweenSize(UDim2.new(1, 0, 1, 0), "Out", "Quad", 0.5)
    LoadStatus.Text = "Sucesso!"
    wait(0.5)
    LoadingFrame:TweenPosition(UDim2.new(0.5, -110, 1.5, 0), "In", "Back", 1)
    wait(1)
    LoadingFrame:Destroy()
    MainFrame.Visible = true
    ToggleBtn.Visible = true
end)

